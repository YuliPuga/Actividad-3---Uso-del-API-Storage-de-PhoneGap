<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" id="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" charset="utf-8">

function vacia(){}
	$(document).ready(function(){
	var myDB;

//Open Database Connection
	document.addEventListener("deviceready",onDeviceReady,false);

function onDeviceReady(){
	myDB = window.sqlitePlugin.openDatabase({name: "biblioteca.db", location: 'default'}); //objeto que abre una conexión con la base de datos
	myDB.transaction(function(transaction) { //transaction es un objeto que contiene o puede o regresa llamadas a los metodos para el uso de SQL
    transaction.executeSql('CREATE TABLE IF NOT EXISTS libros(id integer primary key, titulo text, autor text)', [], //uso del metodo executeSQL de forma anonima en lugar de guardar la Consulta en una variable 
    });
		
	   // Una vez creada la tabla, inserta entradas en ella
    tx.executeSql('INSERT INTO libros (titulo, autor) VALUES ("Manual del guerrero movil", "Carlos Solis")');
    tx.executeSql('INSERT INTO libros (titulo, autor) VALUES ("Abraham Lincoln: Cazador de Vampiros", "Seth Grahame-Smith")');
    tx.executeSql('INSERT INTO libros (titulo, autor) VALUES ("Alicia en el pais de las maravillas", "Lewis Caroll")');
}

//Insertar
$("#insertar").click(function(){
  var titulo=$("#titulo").val(); //trayendo los valores de los textinputs
  var autor=$("#autor").val();
  
  myDB.transaction(function(transaction) {
        var executeQuery = "INSERT INTO libros (titulo, autor) VALUES (?,?)";            //consulta SQL
        transaction.executeSql(executeQuery, [titulo,autor]
            , function(tx, result) {
                navigator.notification.alert('Datos insertados con éxito', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Inserción', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );
            },
            function(error){
              navigator.notification.alert('Ocurrió un error al insertar los datos', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Error', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );
            });
    });
});
//Display Table Data
$("#showTable").click(function(){
  $("#TableData").html(""); //funcion jquery para llamar anonimamente a la tabla
  myDB.transaction(function(transaction) {
  transaction.executeSql('SELECT * FROM libros', [], function (tx, results) {
       var len = results.rows.length, i;
       
       for (i = 0; i < len; i++){ //por cada renglón de la tabla en la BD se crea un renglón en la tabla HTML
		
		$("#TableData").append("<tr><td>"+results.rows.item(i).id+"</td><td>"+results.rows.item(i).hermano+"</td><td>"+results.rows.item(i).regalo+"</td><td ><a href='edit.html?id="+results.rows.item(i).id+"&hermano="+results.rows.item(i).hermano+"&regalo="+results.rows.item(i).regalo+"'>Editar</a> &nbsp;&nbsp; <a class='delete' href='#' id='"+results.rows.item(i).id+"'>Borrar</a></td></tr>");
       }//arriba se mandaron los datos (ID hermano y reglao) con el URL hacia el nuevo html 
    }, null);
  });
});
//Delete Data from Database
$(document.body).on('click', '.delete' ,function(){ //función JQuery .delete es la clase a la que pertenece ese <a>
  var id=this.id;
  myDB.transaction(function(transaction) {
    var executeQuery = "DELETE FROM libros where id=?";
    transaction.executeSql(executeQuery, [id],
      //On Success
      function(tx, result) { navigator.notification.alert('Datos eliminados con éxito', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Eliminación', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );},
      //On Error
      function(error){ navigator.notification.alert('Ocurrió un error al eliminar los datos', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Error', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );});
  });
});
$("#DropTable").click(function(){
    myDB.transaction(function(transaction) {
        var executeQuery = "DROP TABLE  IF EXISTS libros";
        transaction.executeSql(executeQuery, [],
            function(tx, result) { navigator.notification.alert('Tabla eliminada con éxito', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Eliminación', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );},
            function(error){navigator.notification.alert('Ocurrió un error al eliminar la tabla', // Subtitulo de la ventanita o cuerpo
          vacia,
          'Error', // Titulo de la ventanita
          'Aceptar' // Etiqueta del boton
          );}
        );
    });
});
});
</script>

<style>
            button {
                width: 90%;
                height: 25px;
                margin: 5px auto;
            }
            input {
                width: 90%;
                height: 25px;
                margin: 5px auto;
            }
            
            ul{margin:0; padding:0; font-size:12px}
            li{list-style-type:none; padding:10px 0; border-bottom: solid 1px #ccc }
        </style>

</head>
<body>
	<center>
<h1 style="color: white;">Biblioteca</h1>
	</center>

<label>Titulo</label>
<input type="text" id="titulo" placeholder="Titulo" >
<p></p>
<label>Autor</label>	
<input type="text" id="autor" placeholder="Autor" >
  
<p></p>
<button id="insertar" >Agregar nuevo libro/button>
<p></p>
		
<button id="showTable">Mostrar Tabla</button>
<p></p>
<table class="table">
<thead>
<th>ID</th>
<th>Titulo</th>
<th>Autor</th>
<th>Acciones</th>
</thead>
<tbody id="TableData">
</tbody>
</table>
<p></p>
<button id="DropTable" >Eliminar la tabla</button>
<p></p>
</body>
</html>
